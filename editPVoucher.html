<!DOCTYPE html>
<html>
    <head>
        <title>Payment Voucher</title>
        <link rel="icon" href="./Logo_Ezi2travel_2.png" type="image/x-icon">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <style>
        body { background-image: linear-gradient(aliceblue, rgb(142, 195, 242));background-attachment: fixed; text-align:left;}
        .Done{ background-color:green; color:white; }
        .Pending{ background-color:orangered; color:white; }
        .Rejected{ background-color:red; color:white; }

        label{
            display:inline-block;
            width: 30%;
            font-size: 25px;
            font-weight: bold;
            margin-left: 5%;
        }
        p{
            display:inline-block;
            font-size: 25px;
            font-family: Arial, Helvetica, sans-serif;
        }
        input,select,textarea{
            font-size: 20px;
            width :30%
        }
        h1{
            color:rgb(0, 60, 255); 
            text-align: center; 
            font-size: 45px; 
            font-weight: bold; 
            font-style: italic;
        }
        
        
    </style>
    <body>
        <h1>PAYMENT VOUCHER</h1>
        <div>
            <div>
                <label>PAYMENT VOUCHER NO : </label>
                <p id="payment_no" type="number" onkeyup="this.value = this.value.toUpperCase();"></p>
            </div>
            <div>
                <label>BY :</label>            
                <input type="text" disabled id="userid1"/><br/><br/>
            </div>
            <div>
                <label>DATE OF PAYMENT : </label>
                <p id="date_payment" type="date" onkeyup="this.value = this.value.toUpperCase();"></p>
            </div>
            <div >
                <label>NAME : </label>
                <input id="index" placeholder="Enter name" onkeyup="this.value = this.value.toUpperCase();">
            </div><br/>
            <div >
                <label>PHONE NUMBER : </label>
                <input type="text" id="phone_no" placeholder="Enter name" onkeyup="this.value = this.value.toUpperCase();">
            </div><br/>
            <div>
                <label>AMOUNT : </label>
                <input type="text" id="amount" placeholder="Enter amount" onkeyup="this.value = this.value.toUpperCase();">
            </div><br/>
            <div>
                <label>DETAILS : </label>
                <textarea type="text" id="references" placeholder="Enter references" ></textarea>
            </div><br/>
            <div>
                <label>REFERENCE NO : </label>
                <input type="text" id="ref_no" placeholder="Enter reference number" onkeyup="this.value = this.value.toUpperCase();">
            </div><br/>
            <div>
                <label>PAYMENT METHOD : </label>
                <select type="number" name="method">
                    <option class="cash"  value="cash" >CASH</option>
                    <option class="bank" value="bank" >BANK</option>
                    <option class="cheque" value="cheque" >CHEQUE</option>
                </select>
            </div><br/>
            <div>
            <label>PAYMENT CATEGORY : </label>
                <select type="number" name="type">
                    <option class="Advertisement"  value="Advertisement">Advertisement & Promotion</option>
                    <option class="Assessment"  value="Assessment">Assessment / Quit Rent</option>
                    <option class="Bank"  value="Bank">Bank Charges</option>
                    <option class="Bonus"  value="Bonus">Bonus & Incentive</option>
                    <option class="commission"  value="commission">Commission</option>
                    <option class="Refund"  value="Refund">Customer Refund</option>
                    <option class="Depreciaion"  value="Depreciaion">Depreciaion</option>
                    <option class="Remuneration"  value="Remuneration">Director Remuneration</option>
                    <option class="Donation"  value="Donation">Donation</option>
                    <option class="Utilities"  value="Utilities">Electric, Water & Utilities</option>
                    <option class="Entertainment"  value="Entertainment">Entertainment Expense</option>
                    <option class="EPF"  value="EPF">EPF & SOCSO</option>
                    <option class="General"  value="General">General Expense</option>
                    <option class="GST"  value="GST">GST Expense</option>
                    <option class="Insurance"  value="Insurance">Insurance</option>
                    <option class="Legal"  value="Legal">Legal Expense</option>
                    <option class="License"  value="License">License & Permit</option>
                    <option class="Loan"  value="Loan">Loan Interest</option>
                    <option class="Motor"  value="Motor">Motor Vehicle Maintenance</option>
                    <option class="Office"  value="Office">Office Keep Up & Maintenance</option>
                    <option class="Petrol"  value="Petrol">Petrol, Toll & Parking</option>
                    <option class="Postage"  value="Postage">Postage & Stamp</option>
                    <option class="Printing"  value="Printing">Printing & Stationery</option>
                    <option class="Proprietor"  value="Proprietor">Proprietor Salary & Allowance</option>
                    <option class="Reading"  value="Reading">Reading Material & Newspaper</option>
                    <option class="Rental"  value="Rental">Rental for Premise</option>
                    <option class="Retail"  value="Retail">Retail Purchase</option>
                    <option class="Roadtax"  value="Roadtax">Roadtax & Insurance</option>
                    <option class="Salary"  value="Salary">Salary, Allowance & Wage</option>
                    <option class="Audit"  value="Audit">Secretary, Accounting & Audit</option>
                    <option class="Service"  value="Service">Service Expense</option>
                    <option class="SST"  value="SST">SST Expense</option>
                    <option class="Staff"  value="Staff">Staff Benefits</option>
                    <option class="Refreshments"  value="Refreshments">Staff Refreshments</option>
                    <option class="Telephone"  value="Telephone">Telephone & Internet</option>
                    <option class="Training"  value="Training">Training Education</option>
                    <option class="Transportation"  value="Transportation">Transportation & Custom Duty</option>
                    <option class="Travelling"  value="Travelling">Travelling Expense</option>
                    <option class="Zakat"  value="Zakat">Zakat</option>
                    <option class="COGS"  value="COGS">Cost -(COGS)-</option>
                    <option class="Return"  value="Return">Customer Return</option>
                    <option class="Discount"  value="Discount">Discount from Supplier</option>
                    <option class="purchases"  value="purchases">Material Purchase</option>
                </select><br/>
            </div><br/>
            <div>
                <label for="visa">PAYMENT STATUS :</label>
                <select name="status" onchange="this.className=this.options[this.selectedIndex].className;" class="Done">
                <option class="Done" value="Done" >Done</option>
                <option class="Pending"  value="Pending" >Pending</option>
                <option class="Rejected"  value="Rejected" >Rejected</option>
                </select>
            </div>
        </div>
        <br><br>

        <div style="text-align: center;">
            <div >
                <button title="Update Payment Voucher" id="updateBTN" style="background-color: green ; color: white; padding: 10px 25px; border-radius: 10px" ><i class="fa fa-pencil"></i> UPDATE </button>
                <button title="Delete Payment Voucher" id="deleteBTN" style="background-color: red ; color: white; padding: 10px 25px; border-radius: 10px" ><i class="fa fa-trash"></i> DELETE </button>
                <button title="Return to Main Payment Voucher Page" onclick="back()" style="background-color: rgb(0, 166, 255) ; color: black; padding: 10px 25px; border-radius: 10px" ><i class="fa fa-arrow-left"></i> BACK</button>
                <button title="Print this Payment Voucher" id="print" style="background-color :rgb(255, 230, 0); color:black; padding: 10px 25px; border-radius: 10px""><i class="fa fa-print" ></i> PRINT</button>
            </br></br>            
            </div> 
            <br /><br/>
        </div>

        <div id="table1" style="display: none;" >
            <div id="company_info" style="margin: 5px; display: flex;">
                <img src="./Logo_Ezi2travel_2.png" style="width:100px; height:100px; margin-top: 30px;">
                <div id="company_address" style="margin-left: 5px; margin-top: 20px; width: 100%;" >
                    <p style="line-height: 0.5;font-weight: bold;">EZI2TRAVEL SDN BHD (759360-P)</p>
                    <p style="line-height: 0.5; ">9G, JALAN DESA ARA,
                    <p style="line-height: 0.5;">TAMAN DESA ARA,</p>
                    <p style="line-height: 0.5;">13300 TASEK GELUGOR,</p>
                    <p style="line-height: 0.5;">PULAU PINANG</p>
                    <p style="line-height: 0.5;">PHONE : +604-5334834 / </p>
                    <p style="line-height: 0.5;">+60125770564</p>
                    <p style="line-height: 0.5;">Email : ezi2travelsdnbhd@gmail.com /</p> 
                    <p style="line-height: 0.5;">hq@ezi2travel.com</p>
                </div>
                <div id="PV_title" style="margin-left: 50px;" >
                    <div>
                        <h1>PAYMENT VOUCHER</h1>
                        <p id="receipt_no"></p>
                    </div>
                    <div>
                        <p id="date_Pay"></p>
                    </div>
                    <div>
                        <p id="method_Pay"></p>
                    </div>
                    <div>
                        <p id="type_Pay"></p>
                    </div>
                    <div>
                        <p id="reference"></p>
                    </div>
                    <div>
                        <p id="userid2"></p>
                    </div>
                </div>
            </div>
            <br/><br/><hr>
            <div id="customer" >
                <h3 >CUSTOMER : </h3>
                <p id="nama" ></p>
                <p id="no_telefon" ></p>
                <p id="detail_payment"></p>
            </div>
            <hr><br/>
            
            <table id="dataTable" style="width: 100%; height: 30px; margin-left:auto;margin-right:auto; text-align:center">
                <tr>
                    <th style="background-color:white">NO.</th>
                    <th style="background-color:white">ITEMS</th>
                    <th style="background-color:white">AMOUNT</th>
                </tr>
            </table>
            
            <br/><hr/>
            <p>Generated automatically. No signature is required.</p>
        </div>
        
        <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>
        <script>
            function back(){
                let y = document.getElementById("index").innerHTML;
                window.history.go(-1);
            }
        </script>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics.js";
            import {getDatabase, get, ref, set, child, onValue, remove, update} from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
            import { getAuth, setPersistence, browserSessionPersistence, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
            const firebaseConfig = {
              apiKey: "AIzaSyBK0s2IY344TSMqt1no1fySfcvgxozvSuQ",
              authDomain: "databaseezi.firebaseapp.com",
              projectId: "databaseezi",
              storageBucket: "databaseezi.appspot.com",
              messagingSenderId: "500563704547",
              appId: "1:500563704547:web:15bd0c6a9df7a9ba44e3d6",
              measurementId: "G-TYSWSGNT29"
            };

            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);
            const analytics = getAnalytics(app);
            const dbref = ref(db);

            function checkuser(){
                const auth = getAuth();
                onAuthStateChanged(auth, (user) => {
                if (user) {
                    get(child(dbref, 'user/'+user.uid)).then((snapshot)=>{
                    if(snapshot.exists()){
                        // userid1.value = snapshot.val().userid;
                        // userid2.innerHTML = "By : " + snapshot.val().userid;
                    }
                    })
                } 
                else {
                    alert("Please Sign In! ");
                    window.location.href= 'index.html';
                }
                });
            }

            window.addEventListener('load',checkuser);
            window.addEventListener('load',getDate);
            window.addEventListener('load',retData);
            
            const queryString = window.location.search;
            var x = queryString.substring(7);
            
            let text1 = "#PV";
            let text2 = x.toString();
            let result = text1.concat(text2);
            document.getElementById("payment_no").innerHTML = result;
            receipt_no.innerHTML ="RECEIPT NO : " + result;
            
            function getDate(){
                const result1 = new Date().toLocaleDateString('en-GB');
                document.getElementById("date_payment").innerHTML = result1;
            }

            function retData(){
                get(child(dbref, 'PaymentVoucher/' + x)).then((snapshot)=>{
                    if(snapshot.exists()){
                        //payment_no.innerHTML = x;
                        index.value = snapshot.val().name;
                        nama.innerHTML = snapshot.val().name;
                        date_payment.innerHTML =  snapshot.val().date;
                        date_Pay.innerHTML = "DATE : " + snapshot.val().date;
                        amount.value = Number(snapshot.val().amount).toFixed(2);
                        detail_payment.innerHTML = snapshot.val().details;
                        references.value = snapshot.val().details;
                        method_Pay.innerHTML = "PAYMENT METHOD : "+ snapshot.val().method;
                        type_Pay.innerHTML = "PAYMENT TYPE  : "+ snapshot.val().type;
                        phone_no.value = snapshot.val().phone_no;
                        no_telefon.innerHTML = snapshot.val().phone_no;
                        ref_no.value = snapshot.val().reference_no;
                        userid1.value = snapshot.val().user;
                        userid2.innerHTML ="By : " + snapshot.val().user;
                        reference.innerHTML ="REF. NO.  : "+ snapshot.val().reference_no;
                        document.getElementsByName('method')[0].className = snapshot.val().method;
                        document.getElementsByName('method')[0].value = snapshot.val().method;
                        document.getElementsByName('type')[0].className = snapshot.val().type;
                        document.getElementsByName('type')[0].value = snapshot.val().type;
                        document.getElementsByName('status')[0].className = snapshot.val().status;
                        document.getElementsByName('status')[0].value = snapshot.val().status;
                        let date = document.createElement("tr");
                        date.innerHTML = "<td></td><td>Total Paid :</td><td>RM "+Number(snapshot.val().amount).toFixed(2)+"</td>";
                        dataTable.append(date);
                        return;
                    }                        
                })
            }
            let updateBTN = document.getElementById("updateBTN");
            let deleteBTN = document.getElementById("deleteBTN");

            updateBTN.addEventListener('click',updData);
            deleteBTN.addEventListener('click',delData);

            function updData(){
                
                var selector = document.getElementsByName("method")[0];
                var method = selector[selector.selectedIndex].value;
                var selector = document.getElementsByName("type")[0];
                var type = selector[selector.selectedIndex].value;
                var selector = document.getElementsByName("status")[0];
                var status = selector[selector.selectedIndex].value;
                

                update(ref(db,'PaymentVoucher/' + x), {
                
                name: index.value,
                phone_no : phone_no.value,
                amount : amount.value,
                details: references.value,
                reference_no : ref_no.value,
                method : method,
                type: type,
                status : status,
                user : userid1.value
                
                }).then(()=>{
                    alert("Data Updated Successfully !");
                    window.location.href= 'Pvoucher.html';
                }).catch((error)=>{
                    alert(error);
                    window.location.href= 'Pvoucher.html';
                })
                
            }

            function delData(){
                remove(ref(db,'PaymentVoucher/' + x))
                .then(()=>{
                    alert("Data Deleted Successfully !");
                    window.location.href= 'Pvoucher.html';
                })
                .catch((error)=>{
                    alert("unsucessful");
                    window.location.href= 'Pvoucher.html';
                })
                
            }

            var print = document.getElementById("print");
            print.addEventListener('click',createPDF);
            function createPDF(){
                var sTable = document.getElementById('table1').innerHTML;
                var style = "<style>";
                style = style + "table {border: 1px solid black; width: 100%;font: 12px Calibri; margin:10;}";
                style = style + " th {border: 1px solid black; font-size: 18px;text-align: center;}";
                style = style + " td {font-size: 18px;text-align: center;}";
                style = style + "</style>";

                // CREATE A WINDOW OBJECT.
                var win = window.open('', '', 'height=800,width=800');

                win.document.write('<html><head>');
                win.document.write('<title>Credit Note</title>');   // <title> FOR PDF HEADER.
                win.document.write(style);          // ADD STYLE INSIDE THE HEAD TAG.
                win.document.write('</head>');
                win.document.write('<body>');
                win.document.write(sTable);         // THE TABLE CONTENTS INSIDE THE BODY TAG.
                win.document.write('</body></html>');

                //win.document.close(); 	// CLOSE THE CURRENT WINDOW.
                //win.print();    // PRINT THE CONTENTS.
            }
            

        </script>
    </body>
</html>
