<!DOCTYPE html>
<html lang="en">
<head>
    <title>Register Jemaah</title>
    <link rel="icon" href="./Logo_Ezi2travel_2.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        label{
            display:inline-block;
            font-size: 20px;
            font-family: Arial, Helvetica, sans-serif;
            width: 220px; 
        }
        input{
            margin-left: 5%;
            width: 50%;
            font-size: 20px;
            font-family: Arial, Helvetica, sans-serif;
        }
        textarea{
            margin-left: 5%;
            width: 50%;
            height: 10%;
            font-size: 20px;
            font-family: Arial, Helvetica, sans-serif;
        }
        select{
            width: 50%;
            height: 30px;
            font-size: 20px;
            font-family: Arial, Helvetica, sans-serif;
            margin-left: 5%;
        }
        button{
            height:60px;
            width:90px;
        }
        table,
        th,
        td {border: 1px solid black;}
        body {text-align: left; background-image: linear-gradient(aliceblue, rgb(142, 195, 242));background-attachment: fixed;}
        Name {text-transform: uppercase;}
        findnama {text-transform: uppercase;}
        .Yes{ background-color:green; color:white; }
        .No{ background-color:red; color:white; }
        .umrah{background-color:yellow; color:black; }
        .sekatan{background-color:yellow; color:black; }
        .Malaysian{background-color:rgb(0, 45, 128); color:white;}
        .Non-Malaysian{background-color:rgb(255, 51, 51); color:white;}
        .b2{background-color:#008B8B; color:white;}
        .b3{background-color:#8B008B; color:white;}
        .b4{background-color:#2F4F4F; color:white;}
        .Lite{background-color:#3bf507; color:white;}
        .Basic{background-color:#00d5ff; color:white;}
        .Advance{background-color:#d642cf; color:white;}
        .economy{background-color:#FDBD01; color:black;}
        .business{background-color:#AA6C39; color:white;}
        .VisaPelancong{background-color:#e2e200; color:black;}
        .VisaUmrah{background-color:#8a2f23; color:white;}

        h3 {text-align:left}
        .btn {
          background-color: DodgerBlue;
          border: none;
          color: white;
          padding: 12px 16px;
          font-size: 16px;
          cursor: pointer;
        }
        .btn:hover {
          background-color: #4169e1;
        }
        .review{
            margin-left:50%;
            width: device-width;
            
        }
        .form{
            height:100%;
            width:50%;
            position: fixed; 
            z-index: 1; 
            top: 0; 
            left: 5%;  
            overflow-x: hidden;
            padding-top: 20px;
            text-align : left;
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .form::-webkit-scrollbar {
            display: none;
        }
        p{
            display:inline-block;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        
    </style>
</head>

<body>
   
<div class="review">
    <h2 id="index" style="display: none;"></h2>
    <h1 id="datechosen" style="display: none;"></h1>
    <p id="test3" >link ic</p>
    <p id="test4" >link passport</p>
    <p id="test5" >link gambar pemohon visa</p>
</div>

<div class="form" >
    <h1 style="color:BLUE; font-size: 30PX;">EDIT, UPDATE & CREATE JEMAAH HERE</h1>
    <label>PAYMENT STATUS : </label>
    <p style="width:50%;"  id="status_pay"></p><br/>
    <label>NAME : </label>
    <input type="text" id="Name" name="Name" placeholder="Enter name" onkeyup="this.value = this.value.toUpperCase();"/><br><br>
    <label>NAME (IC) : </label>
    <input type="text" id="nama_ic" name="nama_ic" placeholder="Enter name as in IC" onkeyup="this.value = this.value.toUpperCase();"/><br><br>
    <label>NAME (PASSPORT) : </label>
    <input type="text" id="NamePassport" name="NamePassport" placeholder="Enter name as in passport" onkeyup="this.value = this.value.toUpperCase();"/><br><br>
    
    <label for="warganegara">WARGANEGARA :</label>
    <select name="choosewarganegara" onchange="this.className=this.options[this.selectedIndex].className ; changewarganegara()" class="Non-Malaysian">
    <option class="Non-Malaysian"  value="Non-Malaysian" >Non-Malaysian</option>
    <option class="Malaysian" value="Malaysian" >Malaysian</option>
    </select><br/><br/>
    
    <label>IC : </label>
    <input type="number" id="ID" name="ID" placeholder="Enter IC Number"/><br><br>
    <label>PASSPORT NUMBER : </label>
    <input type="text" id="passportNo" name="passportNo" placeholder="Enter passport number" onkeyup="this.value = this.value.toUpperCase();"><br><br>
    <label>AGE : </label>
    <input type="number" id="age" name="age" placeholder="Enter age"/><br><br>
    <label>PHONE NUMBER : </label>
    <input type="text" id="phone_number" name="phone_number" placeholder="Enter phone number"/><br><br>
    <label>PACKAGE DATE : </label>
    <select id="chooseDate" name="chooseDate" onchange="this.className=this.options[this.selectedIndex].className; changeDate() "></select><br><br>
    <label>VISA NO : </label>
    <input type="number" id="visaNo" name="visaNo" placeholder="Enter visa number"/><br><br>
    <label>STATUS : </label>
    <input type="text" id="status" name="status" placeholder="Enter Status"/><br><br>
    <label>PEKERJAAN : </label>
    <input type="text" id="pekerjaan" name="pekerjaan" placeholder="Enter Occupation"/><br><br>
    <label>ALAMAT : </label>
    <textarea type="text" id="alamat" name="alamat" placeholder="Enter address"></textarea>
    <br><br>

    <label for="visa">VISA :</label>
    <select name="choosevisa" onchange="this.className=this.options[this.selectedIndex].className ; changeVisa()" class="VisaPelancong">
    <option class="VisaPelancong" value="VisaPelancong" >Visa Pelancong</option>
    <option class="VisaUmrah"  value="VisaUmrah" >Visa Umrah</option>
    </select>
    <br/><br/>

    <label for="makan">MAKAN :</label>
    <select name="choosemakan" onchange="this.className=this.options[this.selectedIndex].className ; changeMakan()" class="No">
    <option class="No"  value="No" >No</option>
    <option class="Yes" value="Yes" >Yes</option>
    </select>
    <br/><br/>

    <label for="katil">KATIL :</label>
    <select name="choosekatil" onchange="this.className=this.options[this.selectedIndex].className ; changeKatil()" class="No">
    <option class="No"  value="No" >No</option>
    <option class="Yes" value="Yes" >Yes</option>
    </select>
    <br/><br/>

    <label for="train">FLIGHT :</label>
    <select name="chooseflight" onchange="this.className=this.options[this.selectedIndex].className ; changeflight()" class="economy">
    <option class="economy" value="economy class" >Economy Class</option>
    <option class="business"  value="business class" >Business Class</option>
    </select>
    <br/><br/>

    <label for="insurance">INSURANCE :</label>
    <select name="chooseInsurance" onchange="this.className=this.options[this.selectedIndex].className ; changeInsurance()" class="No">
    <option class="No"  value="No" >55 Tahun kebawah</option>
    <option class="Yes" value="Yes" >55 - 85 Tahun </option>
    <option class="umrah" value="umrah" >Insurans ada sekatan </option>
    </select> 
    <br/><br/>

    <label for="insurance">TAIF :</label>
    <select name="choosetaif" onchange="this.className=this.options[this.selectedIndex].className ; changetaif()" class="No">
    <option class="No"  value="No" >No</option>
    <option class="Yes" value="Yes" >Yes</option>
    </select> 
    <br/><br/>

    <label for="medicalCard">MEDICAL CARD :</label>
    <select name="choosemedicalCard" onchange="this.className=this.options[this.selectedIndex].className ; changeMedicalCard()" class="No" >
    <option class="No"  value="No" >No</option>
    <option class="Lite" value="Lite" >LITE</option>
    <option class="Basic" value="Basic" >BASIC</option>
    <option class="Advance" value="Advance" >ADVANCE</option>
    <option class="sekatan" value="sekatan" >Medical Card ada sekatan </option>
    </select>   
    <br/><br/>

    <label for="train">TRAIN :</label>
    <select name="choosetrain" onchange="this.className=this.options[this.selectedIndex].className ; changeTrain()" class="No">
    <option class="No"  value="No" >No</option>
    <option class="Yes" value="Yes" >Yes</option>
    </select>  
    <br/><br/>

    <label for="beg">BEG :</label>
    <select name="choosebeg" onchange="this.className=this.options[this.selectedIndex].className ; changeBeg()" class="No">
    <option class="No"  value="No" >No</option>
    <option class="Yes" value="Yes" >Yes</option>
    </select>
    <br/><br/>

    <label for="room">ROOM TYPE :</label>
    <select name="chooseRoom" onchange="this.className=this.options[this.selectedIndex].className ; changeRoom()" class="b2">
    <option class="b2" value="2" >2</option>
    <option class="b3"  value="3" >3</option>
    <option class="b4"  value="5" >4/5</option>
    </select> 
    <br/><br/>

    <label>AGENT NAME : </label>
    <input type="text" id="agent" name="agent" placeholder="Enter Agent Name"/>
    <br><br>
    
    <div>
        <label>INVOICE BEHALF : </label>
        <select class="form-control" id="invoice" name="invoice">  
            <option value="">Search Invoice</option>  
        </select>
    </div>
    <br/><br/>

    <button title="Register New User" id="AddBtn" style="background-color :green; color:white; border-radius: 10px; font-weight: bold; font-size: 18px; ">ADD</button>
    <!--<button title="Register New User" id="RetBtn" style="background-color :Yellow; color:black; border-radius: 10px; font-weight: bold; font-size: 18px;">Retrieve</button> -->
    <button title="Update User" id="UpdBtn" style="background-color :Yellow; color:black; border-radius: 10px; font-weight: bold; font-size: 18px;">UPDATE</button>
    <button title="Delete User" id="DelBtn" style="background-color :Red; color:white; border-radius: 10px; font-weight: bold; font-size: 18px;">DELETE</button>
    <button title="WhatsApp User" id="CtcBtn" style="background-color :rgb(35, 141, 14); color:white; border-radius: 10px; font-size: 13px;"><i class="fa fa-whatsapp" ></i> Whatsapp</button>
    <button title="Return to Homepage" id="btn" style="background-color :rgb(0, 21, 255); color:white; border-radius: 10px; font-weight: bold; font-size: 17px;" onclick="window.location.href='homepage.html'"><i class="fa fa-home" ></i> HOME</button>
    <button title="Return to Search Jemaah" id="btn" style="background-color :rgb(153, 0, 255); color:white; border-radius: 10px; font-weight: bold; font-size: 18px;" onclick="window.location.href='test.html'"><i class="fa fa-arrow-left" ></i> BACK</button>
    <!-- <button id="ClrBtn" style="background-color :rgb(13, 95, 115); color:white; border-radius: 10px; font-weight: bold; font-size: 18px;" onclick="window.location.href='register.html'">CLEAR</button> -->
    <br/><br/><br/><br/>
</div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script>
        function changeDate() {
            var selector = document.getElementsByName("chooseDate")[0];
            var value = selector[selector.selectedIndex].value;
            document.getElementById('datechosen').innerHTML = value;
            }
        document.addEventListener("DOMContentLoaded", changeDate);

        function generate_ic(){
            var x = document.getElementById("test3").innerHTML;
            var y = document.getElementById("test4").innerHTML;
            var z = document.getElementById("test5").innerHTML;
            var a = x.substr(x.indexOf("=") + 1);
            var b = y.substr(y.indexOf("=") + 1);
            var c = z.substr(z.indexOf("=") + 1);
            document.getElementById("test3").innerHTML=`<iframe src="https://drive.google.com/file/d/`+ a + `/preview" width="600" height="400"></iframe>`;
            document.getElementById("test4").innerHTML=`<iframe src="https://drive.google.com/file/d/`+ b + `/preview" width="600" height="400"></iframe>`;
            document.getElementById("test5").innerHTML=`<iframe src="https://drive.google.com/file/d/`+ c + `/preview" width="600" height="400"></iframe>`;


        }
        document.addEventListener("DOMContentLoaded", generate_ic);

        function CallJemaah(){
            window.location.href="https://www.wasap.my/"+ (document.getElementById("phone_number").value);
        }
        CtcBtn.addEventListener("click",CallJemaah);
        
    </script>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics.js";
    import {getDatabase, get, ref, set, child, onValue, remove, update} from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
    import { getAuth, setPersistence, browserSessionPersistence, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBK0s2IY344TSMqt1no1fySfcvgxozvSuQ",
        authDomain: "databaseezi.firebaseapp.com",
        projectId: "databaseezi",
        storageBucket: "databaseezi.appspot.com",
        messagingSenderId: "500563704547",
        appId: "1:500563704547:web:15bd0c6a9df7a9ba44e3d6",
        measurementId: "G-TYSWSGNT29"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const analytics = getAnalytics(app);

    function checkuser(){
    const auth = getAuth();
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const uid = user.uid;
      } else {
        alert("Please Sign In! ");
        window.location.href= 'index.html';
      }
    });
  }

  window.addEventListener('load',checkuser);


  function Getinvoice(){
    const dbRef = ref(db, "Payment");
    onValue( dbRef, (snapshot) => {
      snapshot.forEach((childSnapshot) => {
        const childkey = childSnapshot.key;
        var row = "<option class="+ childkey + "value=" + childkey +">"+ childkey +"</option>";
          $(row).appendTo("#invoice");        
      });
    },
    {
      onlyOnce: true,
    }
    );
  }   

  window.addEventListener('load',Getinvoice);
    

    function Getlist(){
      const dbRef = ref(db, "Package");
      onValue( dbRef, (snapshot) => {
        snapshot.forEach((childSnapshot) => {
          const childkey = childSnapshot.key;
          const childData = childSnapshot.val();
          var row = "<option class="+ childData.name + "value=" + childData.name+">"+childData.name+"</option>";
            $(row).appendTo("#chooseDate");        
        });
      },
      {
        onlyOnce: true,
      }
      );
    } 
    window.addEventListener('load',Getlist);

    const queryString = window.location.search;
    var x = queryString.substring(7);
    document.getElementById("index").innerHTML = x.split("%20").join(" ").toUpperCase();;
    document.getElementById("Name").value = x.split("%20").join(" ").toUpperCase();

    let name = document.getElementById('Name');
    let nama_ic = document.getElementById('nama_ic');
    let NamePassport = document.getElementById('NamePassport');
    let id = document.getElementById('ID');
    let passportNo = document.getElementById('passportNo');
    let age = document.getElementById('age');
    let phone_number = document.getElementById('phone_number');
    let visaNo = document.getElementById('visaNo');
    let status = document.getElementById('status');
    let pekerjaan = document.getElementById('pekerjaan');
    let alamat = document.getElementById('alamat');
    let agent = document.getElementById('agent');
    var date = document.getElementById('datechosen').innerHTML;

    var selector = document.getElementsByName("choosetrain")[0];
    var value = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("choosemedicalCard")[0];
    var value1 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("chooseInsurance")[0];
    var value2 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("chooseRoom")[0];
    var value3 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("chooseflight")[0];
    var value4 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("choosevisa")[0];
    var value5 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("choosetaif")[0];
    var value6 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("choosemakan")[0];
    var value7 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("choosebeg")[0];
    var value8 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("choosekatil")[0];
    var value9 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("choosewarganegara")[0];
    var value10 = selector[selector.selectedIndex].value;
    var selector = document.getElementsByName("invoice")[0];
    var value11 = selector[selector.selectedIndex].value;

    let AddBtn = document.getElementById('AddBtn');
    // let RetBtn = document.getElementById('RetBtn');
    let UpdBtn = document.getElementById('UpdBtn');
    let DelBtn = document.getElementById('DelBtn');
    let ClrBtn = document.getElementById('ClrBtn');

    function Interface(e){
        let BtnId = e.target.id;
        const dbref = ref(db);

        if(BtnId == "RetBtn"){
            if(name.value == "" || name.value == null){
                alert("Please fill name of Jemaah !");
                return;
            }
            else{
                RetData();
                return;
            } 
        }
            

        get(child(dbref, 'Testing/' + name.value)).then((snapshot)=>{
            if(snapshot.exists()){
                if(BtnId == "AddBtn"){
                    if(name.value =="" || name.value == null){
                        alert("Please enter name of jemaah");
                        return;
                    }
                    else{
                       alert("Employee already exist, duplicate records not allowed");
                       return; 
                    } 
                }
                    
                else if(BtnId == "UpdBtn" ){
                    if(name.value =="" || name.value == null ||
                        id.value =="" || id.value == null || 
                        age.value =="" || age.value == null ||
                        passportNo.value =="" || passportNo.value == null )
                        {
                        alert("Please enter all details of jemaah");
                        }
                    else{
                        UpdateData();
                        return; 
                    }
                    
                }
                    
                else if(BtnId == "DelBtn"){
                    if(name.value =="" || name.value == null )
                        {
                        alert("Please enter name of jemaah");
                        }
                    else{
                        DeleteData();
                        return; 
                    } 
                }     
            }
            else{
                if(BtnId == "AddBtn"){
                    if(name.value =="" || name.value == null ||
                        id.value =="" || id.value == null || 
                        age.value =="" || age.value == null ||
                        passportNo.value =="" || passportNo.value == null )
                        {
                        alert("Please enter all details of jemaah");
                        }
                    else{
                        AddData();
                        return; 
                    }
                }
                    
                else if(BtnId == "UpdBtn"){
                    if(name.value =="" || name.value == null  || 
                        age.value =="" || age.value == null ||
                        passportNo.value =="" || passportNo.value == null )
                        {
                        alert("Please enter all details of jemaah");
                        }
                    else{
                        alert("Cannot update, employee does not exist");
                        return; 
                    }
                }
                
                else if(BtnId == "DelBtn"){
                    if(name.value =="" || name.value == null )
                        {
                        alert("Please enter name of jemaah");
                        }
                    else{
                        alert("Cannot delete, employee does not exist");
                        return; 
                    } 
                }
            }
        })
        .catch((error)=>{
            alert("unsucessful");
            console.log(error);
        })

    }

    function AddData(){
        let name = document.getElementById('Name');
        let agent = document.getElementById('agent');
        let nama_ic = document.getElementById('nama_ic');
        let NamePassport = document.getElementById('NamePassport');
        let id = document.getElementById('ID');
        let passportNo = document.getElementById('passportNo');
        let age = document.getElementById('age');
        let phone_number = document.getElementById('phone_number');
        let visaNo = document.getElementById('visaNo');
        let status = document.getElementById('status');
        let pekerjaan = document.getElementById('pekerjaan');
        let alamat = document.getElementById('alamat');
        var date = document.getElementById('datechosen').innerHTML;

        var selector = document.getElementsByName("choosetrain")[0];
        var value = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosemedicalCard")[0];
        var value1 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseInsurance")[0];
        var value2 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseRoom")[0];
        var value3 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseflight")[0];
        var value4 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosevisa")[0];
        var value5 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosetaif")[0];
        var value6 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosemakan")[0];
        var value7 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosebeg")[0];
        var value8 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosekatil")[0];
        var value9 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosewarganegara")[0];
        var value10 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("invoice")[0];
        var value11 = selector[selector.selectedIndex].value;

        set(ref(db,'Testing/' + name.value), {
            id : id.value,
            name : name.value,
            nama_ic : nama_ic.value,
            NamePassport : NamePassport.value,
            nama_ic : nama_ic.value, 
            age : age.value,
            date : date,
            visaNo :visaNo,
            passportNo : passportNo.value,
            train : value,
            medicalcard : value1,
            insurance : value2,
            flight : value4,
            roomtype : value3,
            status : status.value,
            pekerjaan : pekerjaan.value,
            alamat : alamat.value,
            visatype : value5,
            taif : value6,
            makan : value7,
            beg : value8,
            katil : value9,
            agent : agent.value,
            no_telefon : phone_number.value,
            nationality : value10,
            invoice : value11

        }).then(()=>{
            alert("Jemaah Added Successfully !");
        }).catch((error)=>{
            alert("unsucessful");
            console.log(error);
        })
    }

    function RetData(){
        let name = document.getElementById('Name');
        let agent = document.getElementById('agent');
        let nama_ic = document.getElementById('nama_ic');
        let NamePassport = document.getElementById('NamePassport');
        let id = document.getElementById('ID');
        let passportNo = document.getElementById('passportNo');
        let age = document.getElementById('age');
        let phone_number = document.getElementById('phone_number');
        let visaNo = document.getElementById('visaNo');
        let status = document.getElementById('status');
        let pekerjaan = document.getElementById('pekerjaan');
        let alamat = document.getElementById('alamat');
        var date = document.getElementById('datechosen').innerHTML;

        var selector = document.getElementsByName("choosetrain")[0];
        var value = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosemedicalCard")[0];
        var value1 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseInsurance")[0];
        var value2 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseRoom")[0];
        var value3 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseflight")[0];
        var value4 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosevisa")[0];
        var value5 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosetaif")[0];
        var value6 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosemakan")[0];
        var value7 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosebeg")[0];
        var value8 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosekatil")[0];
        var value9 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosewarganegara")[0];
        var value10 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("invoice")[0];
        var value11 = selector[selector.selectedIndex].value;
        const dbref = ref(db);
        
        get(child(dbref, 'Testing/' + name.value)).then((snapshot)=>{
            if(snapshot.exists()){
              name.value = snapshot.val().name;
              NamePassport.value = snapshot.val().NamePassport;
              nama_ic.value = snapshot.val().nama_ic,
              id.value = snapshot.val().id;
              passportNo.value = snapshot.val().passportNo;
              age.value = snapshot.val().age;
              visaNo.value = snapshot.val().visaNo;
              status.value = snapshot.val().status;
              pekerjaan.value = snapshot.val().pekerjaan;
              alamat.value = snapshot.val().alamat;
              agent.value = snapshot.val().agent;
              let x = String(snapshot.val().no_telefon).split(" ").join("") ;
              x =  x.split("-").join("");
              x =  x.split("+").join("");
              if (x[0] != 6){
                x = 6 + String(x);
              }
              phone_number.value = x
              var roomVariable = "b" + snapshot.val().roomtype;

              if(roomVariable =="b5"){
                roomVariable = "b4";
              }

              document.getElementsByName('choosetrain')[0].className = snapshot.val().train;
              document.getElementsByName('choosetrain')[0].value = snapshot.val().train;
              document.getElementsByName('choosemedicalCard')[0].className = snapshot.val().medicalcard;
              document.getElementsByName('choosemedicalCard')[0].value = snapshot.val().medicalcard;
              document.getElementsByName('chooseInsurance')[0].className = snapshot.val().insurance;
              document.getElementsByName('chooseInsurance')[0].value = snapshot.val().insurance;
              document.getElementsByName('chooseRoom')[0].className = roomVariable;
              document.getElementsByName('chooseRoom')[0].value = snapshot.val().roomtype;
              document.getElementsByName('chooseflight')[0].className = snapshot.val().flight;
              document.getElementsByName('chooseflight')[0].value = snapshot.val().flight;
              document.getElementsByName('choosevisa')[0].className = snapshot.val().visatype;
              document.getElementsByName('choosevisa')[0].value = snapshot.val().visatype;

              document.getElementsByName('choosetaif')[0].className = snapshot.val().taif;
              document.getElementsByName('choosetaif')[0].value = snapshot.val().taif;

              document.getElementsByName('choosemakan')[0].className = snapshot.val().makan;
              document.getElementsByName('choosemakan')[0].value = snapshot.val().makan;

              document.getElementsByName('choosebeg')[0].className = snapshot.val().beg;
              document.getElementsByName('choosebeg')[0].value = snapshot.val().beg;

              document.getElementsByName('choosekatil')[0].className = snapshot.val().katil;
              document.getElementsByName('choosekatil')[0].value = snapshot.val().katil;

              document.getElementsByName('choosewarganegara')[0].className = snapshot.val().nationality;
              document.getElementsByName('choosewarganegara')[0].value = snapshot.val().nationality;

              document.getElementsByName('invoice')[0].className = snapshot.val().invoice;
              document.getElementsByName('invoice')[0].value = snapshot.val().invoice;
              

              if(snapshot.val().nationality == "Non-Malaysian" || snapshot.val().age > 80){
                document.getElementsByName('chooseInsurance')[0].className = "umrah";
                document.getElementsByName('chooseInsurance')[0].value = "umrah";
              }
              if(snapshot.val().age > 85){
                document.getElementsByName('choosemedicalCard')[0].className = "sekatan";
                document.getElementsByName('choosemedicalCard')[0].value = "sekatan";
              }

              document.getElementsByName('chooseDate')[0].value = snapshot.val().date;

              document.getElementById("test3").innerHTML = snapshot.val().gambar_ic;
              document.getElementById("test4").innerHTML = snapshot.val().gambar_passport;
              document.getElementById("test5").innerHTML = snapshot.val().gambar_visa;

              var selector = document.getElementsByName("invoice")[0];
              var value11 = selector[selector.selectedIndex].value;

              get(child(dbref, 'Payment/' + value11)).then((snapshot)=>{
                let x = String(snapshot.val().payment_status);

                if(x == "UNPAID"){
                    status_pay.innerHTML = `<div style="text-align:center; margin-left:10%; outline:1px solid black; border-radius:5px " ><p style="color:red; ">UNPAID</p></div>`;
                }
                else if(x == "PARTIALLY PAID"){
                    status_pay.innerHTML = `<div style="text-align:center; margin-left:10%; outline:1px solid black; border-radius:5px " ><p style="color:yellow; ">PARTIALLY PAID</p></div>`;
                }
                else if(x == "FULLY PAID"){
                    status_pay.innerHTML = `<div style="text-align:center; margin-left:10%; outline:1px solid black; border-radius:5px " ><p style="color:green; ">FULLY PAID</p></div>`;
                }
                else if(x == "OVER PAID"){
                    status_pay.innerHTML = `<div style="text-align:center; margin-left:10%; outline:1px solid black; border-radius:5px " ><p style="color:blue; ">OVER PAID</p></div>`;
                }

        })
        


              generate_ic();

              if(name.value == "undefined"){
                name.value = "";
                NamePassport.value = "";
                nama_ic.value = "";
                passportNo.value = "";
                phone_number.value = "";
                status.value = "";
                pekerjaan.value = "";
                alamat.value = "";
                agent.value = "";
              }
            }
            else{
              alert("Jemaah does not exist");
            }
        })
        .catch((error)=>{
            alert("unsucessful");
            console.log(error);
        })
    }

    function UpdateData(){
        let name = document.getElementById('Name');
        let agent = document.getElementById('agent');
        let nama_ic = document.getElementById('nama_ic');
        let NamePassport = document.getElementById('NamePassport');
        let id = document.getElementById('ID');
        let passportNo = document.getElementById('passportNo');
        let age = document.getElementById('age');
        let phone_number = document.getElementById('phone_number');
        let visaNo = document.getElementById('visaNo');
        let status = document.getElementById('status');
        let pekerjaan = document.getElementById('pekerjaan');
        let alamat = document.getElementById('alamat');
        var date = document.getElementById('datechosen').innerHTML;

        var selector = document.getElementsByName("choosetrain")[0];
        var value = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosemedicalCard")[0];
        var value1 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseInsurance")[0];
        var value2 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseRoom")[0];
        var value3 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("chooseflight")[0];
        var value4 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosevisa")[0];
        var value5 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosetaif")[0];
        var value6 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosemakan")[0];
        var value7 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosebeg")[0];
        var value8 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosekatil")[0];
        var value9 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("choosewarganegara")[0];
        var value10 = selector[selector.selectedIndex].value;
        var selector = document.getElementsByName("invoice")[0];
        var value11 = selector[selector.selectedIndex].value;

        if(date == null || date ==""){
            update(ref(db,'Testing/' + name.value), {
                id : id.value,
                NamePassport : NamePassport.value,
                nama_ic : nama_ic.value,
                age : age.value,
                passportNo : passportNo.value,
                visaNo : visaNo.value,
                train : value,
                medicalcard : value1,
                insurance : value2,
                roomtype : value3,
                flight : value4,
                status : status.value,
                pekerjaan : pekerjaan.value,
                alamat : alamat.value,
                visatype : value5,
                taif : value6,
                makan : value7,
                beg : value8,
                katil : value9,
                agent : agent.value,
                no_telefon : phone_number.value,
                nationality : value10,
                invoice : value11

            }).then(()=>{
                alert("Data Updated Successfully !");
            }).catch((error)=>{
                alert(error);
                console.log(error);
            })
        }
        else{
            update(ref(db,'Testing/' + name.value), {
                id : id.value,
                NamePassport : NamePassport.value,
                nama_ic : nama_ic.value,
                age : age.value,
                no_telefon : phone_number.value,
                date : date,
                pakej : date,
                visaNo : visaNo.value,
                passportNo : passportNo.value,
                train : value,
                medicalcard : value1,
                insurance : value2,
                roomtype : value3,
                flight : value4,
                status : status.value,
                pekerjaan : pekerjaan.value,
                alamat : alamat.value,
                visatype : value5,
                taif : value6,
                makan : value7,
                beg : value8,
                katil : value9,
                agent : agent.value,
                nationality : value10,
                invoice : value11
                
            }).then(()=>{
                alert("Data Updated Successfully !");
            }).catch((error)=>{
                alert(error);
                console.log(error);
            })
        }
        
    }

    function DeleteData(){
        remove(ref(db,'Testing/' + name.value))
        .then(()=>{
            alert("Data Deleted Successfully !");
        })
        .catch((error)=>{
            alert("unsucessful");
            console.log(error);
        })
    }


    AddBtn.addEventListener('click',Interface);
    window.addEventListener('load',RetData);
    UpdBtn.addEventListener('click',Interface);
    DelBtn.addEventListener('click',Interface);
    //RetBtn.addEventListener('load',RetData);


    

    </script>
</body>
</html>

<!-- 
    <h2 id="train"></h2>  
  <script>
    function changeTrain() {
    var selector = document.getElementsByName("choosetrain")[0];
    var value = selector[selector.selectedIndex].value;
    document.getElementById('train').innerHTML = value;
    }
    document.addEventListener("DOMContentLoaded", changeTrain);
  </script> 
-->
