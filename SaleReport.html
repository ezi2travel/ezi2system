
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <title>Sale Report</title>
        <link rel="icon" href="./Logo_Ezi2travel_2.png" type="image/x-icon">
    </head>
    <body>
        <h1></h1>
        <label>Day</label>
        <select id="chooseday" name="chooseday" onchange="this.className=this.options[this.selectedIndex].className" ></select>

        <label>Month</label>
        <select id="choosemonth" name="choosemonth" onchange="this.className=this.options[this.selectedIndex].className"></select>

        <label>Year</label>
        <select id="chooseyear" name="chooseyear" onchange="this.className=this.options[this.selectedIndex].className">
            <option class="2023"  value="2023" >2023</option>
            <option class="2024" value="2024" >2024</option>
        </select>
        <button id="getDateBtn"><i class="fa fa-search" ></i></button>
        <br/><br/>
        
        <ul id="myUL"></ul>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
        <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics.js";
        import {getDatabase, ref, set, push,child, onValue,remove,get,update} from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
        import { getAuth, setPersistence, browserSessionPersistence, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
        

        // TODO: Add SDKs for Firebase products that you want to use
        const firebaseConfig = {
            apiKey: "AIzaSyBK0s2IY344TSMqt1no1fySfcvgxozvSuQ",
            authDomain: "databaseezi.firebaseapp.com",
            projectId: "databaseezi",
            storageBucket: "databaseezi.appspot.com",
            messagingSenderId: "500563704547",
            appId: "1:500563704547:web:15bd0c6a9df7a9ba44e3d6",
            measurementId: "G-TYSWSGNT29"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const analytics = getAnalytics(app);
        const dbref = ref(database);

        function generateoption(){
            for(let x=1; x<=31; x++){
                var row = "";
                row = "<option class="+ String(x).padStart(2,'0') + "value=" + String(x).padStart(2,'0') +">"+ String(x).padStart(2,'0') +"</option>";
                $(row).appendTo("#chooseday");
            }
            for(let x=1; x<=12; x++){
                var row = "";
                row = "<option class="+ String(x).padStart(2,'0') + "value=" + String(x).padStart(2,'0') +">"+ String(x).padStart(2,'0') +"</option>";
                $(row).appendTo("#choosemonth");
            }
        }

        window.addEventListener('load',generateoption);

        

        let getDateBtn = document.getElementById("getDateBtn");
        getDateBtn.addEventListener('click',getDate);

        function getDate(){
            var selector = document.getElementsByName("chooseday")[0];
            var value1 = selector[selector.selectedIndex].value;
            var selector = document.getElementsByName("choosemonth")[0];
            var value2 = selector[selector.selectedIndex].value;
            var selector = document.getElementsByName("chooseyear")[0];
            var value3 = selector[selector.selectedIndex].value;
            alert(value1+value2+value3);
        }

        

        function GetPackage(){
            get(child(dbref,'Payment')).then((snapshot)=>{
                snapshot.forEach(std => {
                    PackageListItem(std);
                }); 
            });
        }

            function PackageListItem(std){
                let key = std.key;
                let value = std.val();
                let no ;
                let name = value.name;
                let x ;
                let y = value.payment_no;
                //number =  number + `<p>Number Of Payment : ` + y +'</p>' ;

                for(x = 1; x <= y ; x++){ 
                let date = document.createElement('li');
                let number = "";
                let text = "";                     
                    get(child(dbref,'Payment/'+ name +"/payment/"+x)).then((snapshot)=>{
                        text =  `<p> Amount : RM ` +  Number(snapshot.val().amount).toFixed(2)+`</p>` ;
                        number = `<p> Date Of Payment : ` + snapshot.val().date +`</p>` ;
                        date.innerHTML = `<p style="font-weight:bold">`+key+`</p>` + text + number;
                        myUL.append(date);
                    });
                }

                
            } 

            window.addEventListener('load',GetPackage);
        </script>

    </body>
</html>
